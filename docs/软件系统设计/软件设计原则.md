# 软件设计原则

软件设计主要关注如何设计一个高质量软件系统，使其满足用户**需求**，同时具有良好的**可维护性、可扩展性、可重用性、可移植性**等好的特性。其主要分为软件架构设计和详细设计两个阶段。本课程的主要关注面向对象（$\text{OO}$）。

面向对象过程主要分为几个阶段：**面向对象分析**并结合领域模型确立软件架构、**面向对象设计**和**面向对象编程**，即从**高层设计**向**低层设计**演进。

<div style="display: flex; align-items: center; justify-content: center; flex-direction: column; padding-top:10px">
    <img src="/image/Screen Shot 2025-02-23 at 11.17.17 PM.png" alt="" style="width: 80%" />
    <p style="font-size: 12px; color: gray;">面向对象分析（OOA）、面向对象设计（OOD）和面向对象编程（OOP）</p>
</div>

一般来说，后两者，即从面向对象设计到面向对象编程这一部分，相对较为简单，只是将设计的类和对象映射到编程语言中。而前两者之间的跨越则是一个**较为复杂**的过程，需要利用**丰富的经验**和**熟练度**来完成。这就需要长期的实践和积累。

<div style="display: flex; align-items: center; justify-content: center; flex-direction: column; padding-top:10px">
    <img src="/image/Screen Shot 2025-02-23 at 11.22.00 PM.png" alt="" style="width: 80%" />
    <p style="font-size: 12px; color: gray;">从分析到设计的过程几乎等同于“魔法”</p>
</div>

为了有助于软件设计的工程化，在长期的实践和积累中，人们总结出了一些**软件设计原则**。利用这些原则，可以帮助我们更好的设计软件系统，提高软件系统的质量。

## 面向对象设计原则概述

知名软件大师 $\text{Robert C. Martin}$ 认为，一个可维护性较低的软件设计，通常有以下弊病：**过于僵硬、过于脆弱、复用率低、粘度过高**（即添加新内容很困难）。总结地讲，面向对象的设计原则主要就是软件的高**可维护性**和高**可复用性**。软件的可维护性是指软件在发布后，能够被有效地修改、更新、修复和扩展的难易程度。可维护性高的软件能够快速适应新的需求、修复错误，并且不会引入新的问题。软件的可复用性是指软件组件（如代码、模块、库、框架等）能够在不同项目或系统中被重复使用的程度。可复用性高的组件能够减少开发时间、提高开发效率，并降低开发成本。**遵循这一主要原则，我们可以提高软件开发的效率，减少成本；同时提升软件质量。此外，恰当的可复用性还可以改善系统的可维护性。**

基于这一出发点，人们总结出了一些面向对象设计原则。这些原则**并不是孤立存在的，他们相互依赖，互相补充**。

## 单一职责原则（$\text{SRP}$）

> 英文全称：**`Single Responsibility Principle`**

**定义** 一个对象应该只包含**单一的职责**，并且该职责被完整地封装到一个类中。

**另一种定义** 就一个类而言，应该**仅有一个**引起它变化的原因。

> [!NOTE] 变化的原因
>
> 一个类中的变化指由于需求点的变化而引起的变化。如果一个类有多个引起它变化的原因，那么这个类就有多个职责。

一般来说，一个类承担的职责**越多**，那么它**被复用的可能性越小**。当职责过多时，其中的一个职责发生变化，可能会影响其他职责，导致系统的不稳定。另外，遵循单一职责原则也是实现**高内聚、低耦合**的指导方针。

> [!TIP] 职责
> 
> 类的职责指类在面向对象编程中承担的功能和任务。一般来说，类的职责分为两种：
> 
> - **数据职责**：负责存储数据，如类的属性。
> - **行为职责**：负责完成某种功能，如类的方法。

<div style="display: flex; align-items: center; justify-content: center; flex-direction: column; padding-top:10px">
    <img src="/image/Screen Shot 2025-02-23 at 11.41.10 PM.png" alt="" style="width: 80%" />
    <p style="font-size: 12px; color: gray;">利用单一职责原则优化设计</p>
</div>

## 开闭原则（$\text{OCP}$）

> 英文全称：**`Open-Closed Principle`**

**定义** 一个软件实体（类、模块、函数等）应该**对扩展开放**，**对修改关闭**。

开闭原则表示，在设计一个软件实体时，应该使其通过**扩展**来改变行为，而不是通过修改已有的代码来实现变化。开闭原则是抽象化的体现。

<div style="display: flex; align-items: center; justify-content: center; flex-direction: column; padding-top:10px">
    <img src="/image/Screen Shot 2025-02-24 at 10.26.20 AM.png" alt="" style="width: 80%" />
    <p style="font-size: 12px; color: gray;">利用开闭原则优化设计</p>
</div>


## 里氏替换原则（$\text{LSP}$）

> 英文全称：**`Liskov Substitution Principle`**

**定义** 如果对每一个类型为 $S$ 的对象 $O_1$，都有类型为 $T$ 的对象 $O_2$，使得以 $T$ 定义的所有程序 $P$ 在所有对象 $O_1$ 都代换成 $O_2$ 时，程序 $P$ 的行为没有发生变化，那么类型 $S$ 是类型 $T$ 的子类型。

**另一种定义** 所有引用基类（父类）的地方必能透明地使用其派生类（子类）的对象。

里氏替换原则（$\text{LSP}$）主要是说，软件中如果能使用基类对象，那么**一定能够使用其子类对象**，而且**不会出现任何问题**。这是面向对象设计中继承部分的基本原则之一。此外，里氏替换原则还是开闭原则的实现基础。一般在我们的设计时，尽量在类设计中使用基类（抽象类）等，在具体实现时再指定具体的子类。

<div style="display: flex; align-items: center; justify-content: center; flex-direction: column; padding-top:10px">
    <img src="/image/Screen Shot 2025-02-24 at 10.30.14 AM.png" alt="" style="width: 80%" />
    <p style="font-size: 12px; color: gray;">利用 LSP 优化设计</p>
</div>

里氏替换原则间接支持了开闭原则。这样当我们需要扩展一个类时，只需要创建一个新的子类，而不需要修改原有基类的代码。这样就可以实现对扩展开放，对修改关闭。

## 接口隔离原则（$\text{ISP}$）

> 英文全称：**`Interface Segregation Principle`**

**定义** 客户端不应该依赖它不需要的接口。一旦一个接口过大，则需要将它分割成更细小的接口，使用该接口的客户端仅需知道与之相关的方法即可。

> [!NOTE] 接口的说明
>
> 这里的接口不仅仅指 `Java` 中的 `interface`。主要指类对外提供的方法，即与外部交互的方法。

接口隔离原则是讲，应当使用多个**专门的接口**，而非**单一的总接口**。此外，接口只应将客户端需要的方法暴露出来，而隐藏不需要的具体实现。接口隔离原则其实是对单一职责原则的扩展，是单一指责原则在接口层面的体现。

<div style="display: flex; align-items: center; justify-content: center; flex-direction: column; padding-top:10px">
    <img src="/image/Screen Shot 2025-02-24 at 10.38.02 AM.png" alt="" style="width: 80%" />
    <p style="font-size: 12px; color: gray;">利用接口隔离原则优化设计</p>
</div>

## 依赖倒置原则（$\text{DIP}$）

> 英文全称：**`Dependency Inversion Principle`**

**定义** 高层模块**不应该依赖于底层模块**，二者都应该依赖于抽象；**抽象不应该依赖于细节，细节应该依赖于抽象**。

**另一种定义** 应当面向**接口**编程，而不是面向实现编程。

依赖倒转主要意为：代码要依赖抽象的类，而非具体的类。要针对接口或抽象类编程，而不是针对具体类编程。依赖倒转原则是实现开闭原则的**重要手段**。

<div style="display: flex; align-items: center; justify-content: center; flex-direction: column; padding-top:10px">
    <img src="/image/Screen Shot 2025-02-24 at 10.35.26 AM.png" alt="" style="width: 90%" />
    <p style="font-size: 12px; color: gray;">利用依赖倒置原则优化设计</p>
</div>

## 合成复用原则（$\text{CRP}$）

> 英文全称：**`Composite Reuse Principle`**

**定义** 尽量使用**对象组合**，而不是**继承**来达到复用的目的。

合成复用原则是指，在新的对象里通过关联关系（包括组合关系和聚合关系）来使用一些已有的对象，使之成为新对象的一部分；新对象通过委派调用已有对象的方法达到复用已有对象的目的。这一可以减少继承带来的复杂性。**继承**是一种**强耦合**的关系，继承复用一般是静态的，不可在运行时发生改变，没有足够的的灵活性。而**组合/聚合**是一种**弱耦合**的关系，可以在运行时选择性地调用成员对象的操作，动态地改变对象的行为。

<div style="display: flex; align-items: center; justify-content: center; flex-direction: column; padding-top:10px">
    <img src="/image/Screen Shot 2025-02-24 at 10.41.11 AM.png" alt="" style="width: 80%" />
    <p style="font-size: 12px; color: gray;">利用合成复用原则优化设计</p>
</div>

## 迪米特法则（$\text{LoD}$）

> 英文全称：**`Law of Demeter`**

**定义** 每一个软件单位（类、模块、函数等）对**其他的单位**都只有**最少的知识**，而且局限于那些与本单位密切相关的软件单位。换句话说就是只与你的直接朋友通信。

迪米特法则的表述相对而言较为笼统，但它的核心思想就是降低软件单位（实体）之间通信的宽度和深度。这样，当一个单位发生修改时，就会尽可能地减少对其他单位的影响。

还有一种狭义的迪米特法则：如果两个类之间不必彼此直接通信，那么这两个类就**不应当发生直接的相互作用**。如果其中一个类需要调用另一个类的方法，可以通过**第三者转发**这个调用。此外，经常变化的类应当被封装起来，其他类应该调用封装好的类来进行通信。狭义的迪米特法则关注类之间的耦合，而广义的迪米特法则关注对信息隐藏的控制。

<div style="display: flex; align-items: center; justify-content: center; flex-direction: column; padding-top:10px">
    <img src="/image/Screen Shot 2025-02-26 at 10.07.02 AM.png" alt="" style="width: 85%" />
    <p style="font-size: 12px; color: gray;">利用迪米特法则优化设计</p>
</div>

::: tip 指导性建议
迪米特法则提供了以下指导性建议：

- 在类的划分上，应当尽量创建**松耦合**的类，类之间的耦合度越低，就越有利于复用，一个处在松耦合中的类一旦被修改，不会对关联的类造成太大波及；
- 在类的结构设计上，每一个类都应当**尽量降低**其成员变量和成员函数的**访问权限**；
- 在类的设计上，只要有可能，一个类型应当设计成**不变类**；
- 在对其他类的引用上，一个对象对其他对象的**引用应当降到最低**。
:::

## 总结

前文提到的**前五个原则**取首字母，合称 $\text{SOLID}$ 原则。这是经典的面向对象设计的核心原则。除此之外，我们还有**合成复用原则**和**迪米特法则**，作为面向对象设计原则的补充与优化。

<div style="display: flex; align-items: center; justify-content: center; flex-direction: column; padding-top:10px">
    <img src="/image/Screen Shot 2025-06-14 at 8.07.38 PM.png" alt="" style="width: 60%" />
    <p style="font-size: 12px; color: gray; margin-bottom: 0; line-height: 20px;">SOLID & DRY (Do not repeat yourself) in Java Ending</p>
    <p style="font-size: 12px; color: gray; margin-top: 0; line-height: 24px;">Originally from <span style="font-style: italic;">"All Programming Endings"</span> on <a href="https://www.youtube.com/watch?v=3HEGi_aVUv8">YouTube</a></p>
</div>
